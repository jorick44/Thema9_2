---
title: "EDA Jorick Baron"
author: "Jorick Baron"
output: pdf_document
---

```{r setup, message=FALSE}
library(tidyr)
library(dplyr)
library(ggplot2)
library(gridExtra)
library(stringr)
library(knitr)
library(kableExtra)
```

In this EDA we will explore the data downloaded from [here](https://www.kaggle.com/johnjdavisiv/urinary-biomarkers-for-pancreatic-cancer). For future reference we will describe the data in the codebook below.

```{r codebook, echo=TRUE}
codebook <- read.delim("Data/codebook.csv", sep = ",")
kable(codebook, caption = "Table 1: Codebook", align = "lcccr", booktabs = T) %>%
  kable_styling(latex_options = c("scale_down"))
```

\pagebreak

First we will load in the data and to check if it has loaded in properly we look at the structure of the loaded data.

```{r structure, echo=TRUE}
data <- read.table(file="Data/source/Debernardi_et_al_2020_data.csv", sep = ",", header = T, na.strings = "")
str(data)
```

Thus far it seems to have loaded correctly.

We will also check the first few records maybe catch some errors.

```{r head}
head(data)
```

The data seems to have quite a few NAs, reading further into the description most would be expected i.e. no stage if there is no cancer nor a diagnosis.

Let's check that nothing went wrong with those two anyway.

```{r check NA diagnosis}
healthy <- subset(data, diagnosis == 1, select = c(diagnosis, stage, benign_sample_diagnosis))
cancerfree <- subset(data, diagnosis == 2, select = c(diagnosis, stage, benign_sample_diagnosis))
cancerous <- subset(data, diagnosis == 3, select = c(diagnosis, stage, benign_sample_diagnosis))

stage_na_count <- sum(is.na(data$stage))
bsd_na_count <- sum(is.na(data$benign_sample_diagnosis))
paste("all these numbers should be the same number", stage_na_count - nrow(cancerfree), bsd_na_count - nrow(cancerous), nrow(healthy))
```

Those numbers lined up to expectations.

The NAs in columns "plasma_CA19_9" and "REG1A" are supposed to be there because not every patient had been fully tested:\
"REG1A ... Only assessed in 306 patients", "plasma_CA19_9 ... Only assessed in 350 patients" see Debernardi et al 2020 documentation.csv in the source files.\
However to make sure everything is correct these numbers will be tested.

```{r check NA biomarkers}
n_plasma_CA19_9 <- nrow(data) - sum(is.na(data$plasma_CA19_9))
n_REG1A <- nrow(data) - sum(is.na(data$REG1A))
paste("REG1A:", n_REG1A, "plasma_CA19_9:", n_plasma_CA19_9)
```

These numbers are correct.

Are there more NAs?

```{r final NA check}
sum(is.na(data[, c(1:6, 10:13)]))
```

0 NAs remaining.

Let's look at a summary of the data.

```{r}
summary(data[,c(4, 9:14)])
```

Much of the data seems to be imbalanced with outliers.

Now let's take a closer look at the data itself using box-plots.

```{r boxplots ungrouped, fig.height=10, fig.width=20, message=FALSE, warning=FALSE, paged.print=FALSE}
p1<- ggplot(data=data)+
  geom_boxplot(mapping = aes(x = "",
                            y = age))+
  ylab("age in years") + 
  xlab(NULL)

p2<- ggplot(data=data)+
  geom_boxplot(mapping = aes(x = "",
                            y = plasma_CA19_9))+
  ylab("plasma_CA19_9 in U/ml") + 
  xlab(NULL)+
  ylim(0,500)

p3<- ggplot(data=data)+
  geom_boxplot(mapping = aes(x = "",
                            y = creatinine))+
  ylab("creatinine in mg/ml") + 
  xlab(NULL)

p4<- ggplot(data=data)+
  geom_boxplot(mapping = aes(x = "",
                            y = LYVE1))+
  ylab("LYVE1 in ng/ml") + 
  xlab(NULL)+
  ylim(0,17)

p5<- ggplot(data=data)+
  geom_boxplot(mapping = aes(x = "",
                            y = REG1B))+
  ylab("REG1B in ng/ml") + 
  xlab(NULL)+
  ylim(0,600)

p6<- ggplot(data=data)+
  geom_boxplot(mapping = aes(x = "",
                            y = TFF1))+
  ylab("TFF1 in ng/ml") + 
  xlab(NULL)+
  ylim(0,5000)

p7<- ggplot(data=data)+
  geom_boxplot(mapping = aes(x = "",
                            y = REG1A))+
  ylab("REG1A in ng/ml") + 
  xlab(NULL) +
  ylim(0,5000)

grid.arrange(p1, p2, p3, p4, p5, p6, p7, nrow = 2)
```

There are many outliers to take a good look at the whiskers y-limits are in place. Even still it's a lot maybe adding another dimension can correct this.

To add this extra dimension let's look at the difference in diagnoses. To properly do this we will also assign levels to the diagnosis column in the dataframe.

```{r boxplot grouped, fig.height=10, fig.width=20, message=FALSE, warning=FALSE}
data$diagnosis <- factor(data$diagnosis)

gp1 <- ggplot(data = data)+
  geom_boxplot(mapping = aes(x = diagnosis,
                            y = age,
                            group=diagnosis,
                            fill=diagnosis))+
    scale_x_discrete(labels=c("control",
                            "benign hepatobiliary disease",
                            "pancreatic cancer"))+
  xlab("diagnosis")+
  ylab("age in years")

gp2 <- ggplot(data = data)+
  geom_boxplot(mapping = aes(x = diagnosis,
                            y = plasma_CA19_9,
                            group=diagnosis,
                            fill=diagnosis))+
    scale_x_discrete(labels=c("control",
                            "benign hepatobiliary disease",
                            "pancreatic cancer"))+
  xlab("diagnosis")+
  ylab("plasma_CA19_9 in U/ml")+
  ylim(0,500)

gp3 <- ggplot(data = data)+
  geom_boxplot(mapping = aes(x = diagnosis,
                            y = creatinine,
                            group=diagnosis,
                            fill=diagnosis))+
    scale_x_discrete(labels=c("control",
                            "benign hepatobiliary disease",
                            "pancreatic cancer"))+
  xlab("diagnosis")+
  ylab("creatinine in mg/ml")

gp4 <- ggplot(data = data)+
  geom_boxplot(mapping = aes(x = diagnosis,
                            y = LYVE1,
                            group=diagnosis,
                            fill=diagnosis))+
    scale_x_discrete(labels=c("control",
                            "benign hepatobiliary disease",
                            "pancreatic cancer"))+
  xlab("diagnosis")+
  ylab("LIVE1 in ng/ml")+
  ylim(0,17)

gp5 <- ggplot(data = data)+
  geom_boxplot(mapping = aes(x = diagnosis,
                            y = REG1B,
                            group=diagnosis,
                            fill=diagnosis))+
    scale_x_discrete(labels=c("control",
                            "benign hepatobiliary disease",
                            "pancreatic cancer"))+
  xlab("diagnosis")+
  ylab("REG1B in ng/ml")+
  ylim(0,600)

gp6 <- ggplot(data = data)+
  geom_boxplot(mapping = aes(x = diagnosis,
                            y = TFF1,
                            group=diagnosis,
                            fill=diagnosis))+
  scale_x_discrete(labels=c("control",
                            "benign hepatobiliary disease",
                            "pancreatic cancer"))+
  xlab("diagnosis")+
  ylab("TFF1 in ng/ml")+
  ylim(0,5000)

gp7 <- ggplot(data = data)+
  geom_boxplot(mapping = aes(x = diagnosis,
                            y = REG1A,
                            group=diagnosis,
                            fill=diagnosis))+
    scale_x_discrete(labels=c("control",
                            "benign hepatobiliary disease",
                            "pancreatic cancer"))+
  xlab("diagnosis")+
  ylab("REG1A in ng/ml")+
  ylim(0,5000)

grid.arrange(gp1, gp2, gp3, gp4, gp5, gp6, gp7, nrow = 3)
```

The data still has many outliers but by many columns a pattern does emerge.

```{r log transformation,}
trans <- as.data.frame(log(data$plasma_CA19_9))
names(trans) <- "plasma_CA19_9"
trans$creatinine <- log(data$creatinine)
trans$LYVE1 <- log(data$LYVE1)
trans$REG1B <- log(data$REG1B)
trans$TFF1 <- log(data$TFF1)
trans$REG1A <- log(data$REG1A)
trans$diagnosis <- data$diagnosis
head(trans)
```

Now having transformed the data lets see how this influences the distribution.

```{r fig.height=10, fig.width=20}

tgp1 <- ggplot(data = trans)+
  geom_boxplot(mapping = aes(x = diagnosis,
                            y = plasma_CA19_9,
                            group=diagnosis,
                            fill=diagnosis))+
    scale_x_discrete(labels=c("control",
                            "benign hepatobiliary disease",
                            "pancreatic cancer"))+
  xlab("diagnosis")+
  ylab("plasma_CA19_9 in U/ml")

tgp2 <- ggplot(data = trans)+
  geom_boxplot(mapping = aes(x = diagnosis,
                            y = creatinine,
                            group=diagnosis,
                            fill=diagnosis))+
    scale_x_discrete(labels=c("control",
                            "benign hepatobiliary disease",
                            "pancreatic cancer"))+
  xlab("diagnosis")+
  ylab("creatinine in mg/ml")

tgp3 <- ggplot(data = trans)+
  geom_boxplot(mapping = aes(x = diagnosis,
                            y = LYVE1,
                            group=diagnosis,
                            fill=diagnosis))+
    scale_x_discrete(labels=c("control",
                            "benign hepatobiliary disease",
                            "pancreatic cancer"))+
  xlab("diagnosis")+
  ylab("LIVE1 in ng/ml")

tgp4 <- ggplot(data = trans)+
  geom_boxplot(mapping = aes(x = diagnosis,
                            y = REG1B,
                            group=diagnosis,
                            fill=diagnosis))+
    scale_x_discrete(labels=c("control",
                            "benign hepatobiliary disease",
                            "pancreatic cancer"))+
  xlab("diagnosis")+
  ylab("REG1B in ng/ml")

tgp5 <- ggplot(data = trans)+
  geom_boxplot(mapping = aes(x = diagnosis,
                            y = TFF1,
                            group=diagnosis,
                            fill=diagnosis))+
  scale_x_discrete(labels=c("control",
                            "benign hepatobiliary disease",
                            "pancreatic cancer"))+
  xlab("diagnosis")+
  ylab("TFF1 in ng/ml")

tgp6 <- ggplot(data = trans)+
  geom_boxplot(mapping = aes(x = diagnosis,
                            y = REG1A,
                            group=diagnosis,
                            fill=diagnosis))+
    scale_x_discrete(labels=c("control",
                            "benign hepatobiliary disease",
                            "pancreatic cancer"))+
  xlab("diagnosis")+
  ylab("REG1A in ng/ml")

grid.arrange(tgp1, tgp2, tgp3, tgp4, tgp5, tgp6, nrow = 3)
```
